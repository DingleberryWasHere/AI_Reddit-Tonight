<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dingle AI | Skate 3 Edition</title>
    
    <script>
        (function() {
            const storedVersion = localStorage.getItem('puter_version') || 'v2';
            document.write('<script src="https://js.puter.com/' + storedVersion + '/"><\/script>');
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .canvas-container {
            height: 85vh; aspect-ratio: 9/16; max-width: 100%; position: relative;
            box-shadow: 0 0 0 10px #1e293b, 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            background: #000; border-radius: 30px; overflow: hidden;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col md:flex-row">

    <div class="w-full md:w-[420px] flex flex-col border-r border-slate-800 bg-slate-950 z-30 shrink-0 h-full shadow-2xl">
        
        <div class="px-6 py-5 border-b border-slate-800 flex justify-between items-center bg-slate-950 shrink-0">
            <h1 class="text-xl font-bold tracking-tight text-white flex items-center gap-3">
                <div class="bg-indigo-600 text-white p-1.5 rounded-lg shadow-lg"><i data-lucide="bot" class="w-5 h-5"></i></div>
                Dingle<span class="text-slate-500">BOT</span>
            </h1>
            <span class="text-[10px] uppercase font-bold text-blue-500 bg-blue-900/30 border border-blue-900 px-2 py-1 rounded">Local Mode</span>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-8 custom-scroll">

            <section class="space-y-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-xs font-bold text-indigo-400 tracking-wider uppercase">1. Content Source</h2>
                    <button onclick="fetchReddit()" class="bg-slate-800 hover:bg-orange-500/20 hover:text-orange-400 text-slate-400 border border-slate-700 px-3 py-1.5 rounded-md text-[10px] font-bold transition-all flex items-center gap-1.5">
                        <i data-lucide="flame" class="w-3 h-3"></i> Get Reddit Story
                    </button>
                </div>
                <textarea id="scriptText" rows="6" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-sm focus:border-indigo-500 outline-none text-slate-200 resize-none leading-relaxed placeholder-slate-600" placeholder="Paste story here..."></textarea>
            </section>

            <section class="space-y-4">
                <h2 class="text-xs font-bold text-purple-400 tracking-wider uppercase">2. Render Settings</h2>
                <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400">Gameplay</span>
                        <span class="text-xs font-mono text-white bg-slate-800 px-2 py-1 rounded">skate3.mp4</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400">Output Folder</span>
                        <span class="text-xs font-mono text-white bg-slate-800 px-2 py-1 rounded">/exports</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400">Audio</span>
                        <span class="text-xs font-mono text-red-400 bg-red-900/20 px-2 py-1 rounded">MUTED (Safe)</span>
                    </div>
                </div>
            </section>
            
            <section class="space-y-2">
                 <h2 class="text-xs font-bold text-slate-500 tracking-wider uppercase">OpenAI Key (Optional for Rewrite)</h2>
                 <input type="password" id="openaiKey" class="w-full bg-slate-900 border border-slate-800 rounded-lg px-3 py-2 text-xs text-white" placeholder="sk-...">
            </section>

        </div>

        <div class="p-6 border-t border-slate-800 bg-slate-950 grid grid-cols-1 gap-4 z-40 shrink-0">
            <button onclick="sendToPython()" id="renderBtn" class="bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 shadow-lg shadow-emerald-900/20">
                <i data-lucide="download" class="w-5 h-5"></i> EXPORT MP4
            </button>
            <p id="statusMsg" class="text-center text-[10px] text-slate-500">Video will save to your computer</p>
        </div>
    </div>

    <div class="flex-1 bg-slate-950 relative flex justify-center items-center p-4 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
        <div class="canvas-container shadow-2xl flex items-center justify-center bg-black">
             <div class="text-center space-y-4">
                 <h1 class="text-4xl font-black text-white italic">SKATE 3</h1>
                 <p class="text-slate-500 text-sm">Rendering happens in Python Console.<br>Check the folder when done.</p>
             </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        async function fetchReddit() {
            try {
                const res = await fetch(`https://www.reddit.com/r/confessions/top.json?limit=10&t=day`);
                const json = await res.json();
                const posts = json.data.children.filter(p => p.data.selftext.length > 50 && p.data.selftext.length < 800);
                const post = posts[Math.floor(Math.random() * posts.length)]?.data;
                if(post) document.getElementById('scriptText').value = post.selftext;
            } catch(e) { alert("Reddit Fetch Error"); }
        }

        async function sendToPython() {
            const text = document.getElementById('scriptText').value;
            const key = document.getElementById('openaiKey').value;
            const btn = document.getElementById('renderBtn');
            const status = document.getElementById('statusMsg');

            if(!text) return alert("Please enter a script/story first.");

            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> RENDERING...';
            status.innerText = "Python is editing the video... This may take a minute.";
            status.className = "text-center text-[10px] text-yellow-500 animate-pulse";

            try {
                // Sends data to the local Python script
                const response = await fetch('http://localhost:5000/generate-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text, apiKey: key })
                });
                
                const data = await response.json();
                
                if(data.status === 'success') {
                    status.innerText = `SAVED: /exports/${data.filename}`;
                    status.className = "text-center text-[10px] text-emerald-500 font-bold";
                    alert("Export Complete! Check your folder.");
                } else {
                    status.innerText = "Error: " + data.message;
                    status.className = "text-center text-[10px] text-red-500";
                }
            } catch (err) {
                status.innerText = "Connection Failed. Is app.py running?";
                status.className = "text-center text-[10px] text-red-500";
                console.error(err);
            }

            btn.disabled = false;
            btn.innerHTML = '<i data-lucide="download" class="w-5 h-5"></i> EXPORT MP4';
        }
    </script>
</body>
</html>
